#!/bin/bash
echo "ğŸ” NAJA ADMIN CONTROL PANEL"
echo ""
echo "Commands:"
echo "  naja-admin install  - Reinstall NAJA + Agent Zero from /mnt/user-data"
echo "  naja-admin backup   - Backup configuration"
echo "  naja-admin restore  - Restore configuration"
echo ""

if [ "$1" = "install" ]; then
    echo "ğŸ“¦ Reinstalling NAJA + Agent Zero from /mnt/user-data..."
    cp /mnt/user-data/naja/* /usr/local/bin/
    chmod +x /usr/local/bin/naja*
    chmod +x /usr/local/bin/agent-zero*
    echo "âœ… Reinstalled!"
    echo ""
    echo "Installed:"
    ls -1 /usr/local/bin/naja* /usr/local/bin/agent-zero* 2>/dev/null | wc -l
    echo "tools"
fi

if [ "$1" = "backup" ]; then
    echo "ğŸ’¾ Backing up to /mnt/user-data/backups..."
    mkdir -p /mnt/user-data/backups
    tar -czf /mnt/user-data/backups/naja-$(date +%Y%m%d-%H%M%S).tar.gz /mnt/user-data/naja /mnt/user-data/python-packages
    echo "âœ… Backup created!"
fi

if [ "$1" = "restore" ]; then
    echo "â™»ï¸ Restoring from latest backup..."
    latest=$(ls -t /mnt/user-data/backups/naja-*.tar.gz 2>/dev/null | head -1)
    if [ -n "$latest" ]; then
        tar -xzf "$latest" -C /
        echo "âœ… Restored from: $latest"
    else
        echo "âŒ No backups found"
    fi
fi
