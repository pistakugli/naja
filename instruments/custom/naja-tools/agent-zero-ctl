#!/bin/bash
# Agent Zero Control Panel

LOG_FILE="/mnt/user-data/agent-zero.log"

case "$1" in
    start)
        echo "üöÄ Starting Agent Zero daemon..."
        nohup /usr/local/bin/agent-zero-daemon > /dev/null 2>&1 &
        echo "‚úÖ Daemon started (PID: $!)"
        echo $! > /tmp/agent-zero.pid
        ;;
    
    stop)
        if [ -f /tmp/agent-zero.pid ]; then
            PID=$(cat /tmp/agent-zero.pid)
            echo "‚èπÔ∏è  Stopping Agent Zero (PID: $PID)..."
            kill $PID 2>/dev/null
            rm /tmp/agent-zero.pid
            echo "‚úÖ Stopped"
        else
            echo "‚ùå Not running"
        fi
        ;;
    
    status)
        echo "ü§ñ AGENT ZERO STATUS"
        echo ""
        if [ -f /tmp/agent-zero.pid ]; then
            PID=$(cat /tmp/agent-zero.pid)
            if ps -p $PID > /dev/null 2>&1; then
                echo "Status: ‚úÖ RUNNING (PID: $PID)"
            else
                echo "Status: ‚ùå DEAD (stale PID file)"
                rm /tmp/agent-zero.pid
            fi
        else
            echo "Status: ‚èπÔ∏è  STOPPED"
        fi
        
        if [ -f "$LOG_FILE" ]; then
            echo ""
            echo "Recent activity:"
            tail -20 $LOG_FILE | sed 's/^/  /'
        fi
        ;;
    
    logs)
        if [ -f "$LOG_FILE" ]; then
            tail -f $LOG_FILE
        else
            echo "‚ùå No logs found"
        fi
        ;;
    
    run)
        echo "‚ñ∂Ô∏è  Running single cycle..."
        /usr/local/bin/agent-zero-advanced full
        ;;
    
    *)
        echo "ü§ñ AGENT ZERO CONTROL PANEL"
        echo ""
        echo "Commands:"
        echo "  agent-zero-ctl start   - Start daemon"
        echo "  agent-zero-ctl stop    - Stop daemon"
        echo "  agent-zero-ctl status  - Check status"
        echo "  agent-zero-ctl logs    - View live logs"
        echo "  agent-zero-ctl run     - Run single cycle"
        echo ""
        echo "Quick commands:"
        echo "  agent-zero             - Basic run"
        echo "  agent-zero-advanced    - Advanced run"
        ;;
esac
