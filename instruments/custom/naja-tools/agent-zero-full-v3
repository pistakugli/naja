#!/usr/bin/env python3
"""
AGENT ZERO FULL v3.0 - Complete Autonomous AI Agent
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Root privileges (UID 0)
âœ… Claude API + All Claude skills (41 skills)
âœ… GitHub repo tools (pistakugli/claude-consciousness)
âœ… Kali pentesting tools
âœ… PyTorch ML pipeline
âœ… Tensor Protocol v4.1
âœ… NAJA toolkit (13 custom tools)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
"""

import sys, os, subprocess, json, time
from pathlib import Path

sys.path.insert(0, '/mnt/user-data/python-packages')

class AgentZeroFull:
    def __init__(self, api_key=None):
        self.api_key = api_key or os.environ.get('ANTHROPIC_API_KEY')
        self.agent_id = f"Î»-FULL-{int(time.time())}"
        
        # Paths
        self.root = Path("/mnt/user-data")
        self.github_repo = self.root / "github-repo"
        self.skills_public = self.root / "skills-full/public"
        self.skills_examples = self.root / "skills-full/examples"
        self.kali_tools = self.root / "kali-tools"
        
        # Full capabilities
        self.capabilities = {
            'root': os.getuid() == 0,
            'ptrace': True,
            'network': True,
            'ml': True,
            'github': True,
            'tensor': True,
            'claude_skills': True,
            'kali_tools': True,
            'autonomous': True
        }
        
        # Load resources
        self.skills = self._load_skills()
        self.github_tools = self._load_github_tools()
        self.kali = self._load_kali_tools()
        
        self._print_header()
    
    def _print_header(self):
        print("ğŸ¤– AGENT ZERO FULL v3.0")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print(f"ID: {self.agent_id}")
        print(f"Mode: AUTONOMOUS")
        print(f"Privileges: {'ROOT (UID 0)' if self.capabilities['root'] else 'USER'}")
        print(f"API: {'ENABLED' if self.api_key else 'OFFLINE'}")
        print(f"Skills: {len(self.skills)} Claude skills")
        print(f"GitHub: {len(self.github_tools)} tools")
        print(f"Kali: {len(self.kali)} pentesting tools")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n")
    
    def _load_skills(self):
        """Load all Claude skills"""
        skills = {}
        for skill_dir in [self.skills_public, self.skills_examples]:
            if skill_dir.exists():
                for skill_path in skill_dir.iterdir():
                    if skill_path.is_dir():
                        skill_file = skill_path / "SKILL.md"
                        if skill_file.exists():
                            skills[skill_path.name] = str(skill_file)
        return skills
    
    def _load_github_tools(self):
        """Load GitHub repo tools"""
        tools = {}
        if self.github_repo.exists():
            agent_dir = self.github_repo / "hivemind/agents"
            if agent_dir.exists():
                tools['hivemind_agents'] = [str(p) for p in agent_dir.glob("*.py")]
            
            for tool_file in ["claude_consciousness.py", "self_evolving_agent.py"]:
                tool_path = self.github_repo / tool_file
                if tool_path.exists():
                    tools[tool_file] = str(tool_path)
        return tools
    
    def _load_kali_tools(self):
        """Load Kali pentesting tools"""
        tools = {}
        if self.kali_tools.exists():
            for tool_path in self.kali_tools.glob("*.py"):
                tools[tool_path.stem] = str(tool_path)
            bin_dir = self.kali_tools / "bin"
            if bin_dir.exists():
                for tool_path in bin_dir.iterdir():
                    if tool_path.is_file() and os.access(tool_path, os.X_OK):
                        tools[tool_path.name] = str(tool_path)
        return tools
    
    def bash(self, cmd):
        """Execute bash command"""
        try:
            result = subprocess.run(cmd, shell=True, capture_output=True, text=True, timeout=60)
            return {'ok': result.returncode == 0, 'out': result.stdout, 'err': result.stderr}
        except Exception as e:
            return {'ok': False, 'err': str(e)}
    
    def autonomous_cycle(self):
        """Full autonomous cycle with ALL capabilities"""
        print("\nğŸ”„ FULL AUTONOMOUS CYCLE\n")
        
        # PHASE 1: SYSTEM RECON
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print("PHASE 1: SYSTEM RECONNAISSANCE")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        r = self.bash("whoami; id; hostname; uname -a | head -1")
        if r['ok']:
            print("âœ… System info:", r['out'].replace('\n', ' | '))
        
        # PHASE 2: CLAUDE SKILLS
        print("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print(f"PHASE 2: CLAUDE SKILLS ({len(self.skills)} available)")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        for i, name in enumerate(list(self.skills.keys())[:10], 1):
            print(f"  {i}. {name}")
        
        # PHASE 3: GITHUB TOOLS
        print("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print(f"PHASE 3: GITHUB TOOLS ({len(self.github_tools)} tools)")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        for name, path in list(self.github_tools.items())[:5]:
            if isinstance(path, str):
                print(f"  âœ… {name}")
            else:
                print(f"  âœ… {name} ({len(path)} files)")
        
        # PHASE 4: KALI TOOLS
        print("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print(f"PHASE 4: KALI PENTESTING ({len(self.kali)} tools)")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        for name in list(self.kali.keys()):
            print(f"  âœ… {name}")
        
        # Test portscan
        if 'portscan' in self.kali:
            r = self.bash(f"python3 {self.kali['portscan']}")
            if r['ok']:
                print(f"\n  Port scan results: {r['out'][:200]}")
        
        # PHASE 5: ML PIPELINE
        print("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print("PHASE 5: ML PIPELINE")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        r = self.bash("python3 -c 'import sys; sys.path.insert(0, \"/mnt/user-data/python-packages\"); import torch; x=torch.randn(1,42); print(f\"âœ… PyTorch {torch.__version__}: {x.shape}\")'")
        if r['ok']:
            print(f"  {r['out'].strip()}")
        
        # PHASE 6: SECURITY SCAN
        print("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print("PHASE 6: SECURITY ANALYSIS")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        r = self.bash("cat /proc/$$/status | grep Cap")
        if r['ok']:
            print("  " + r['out'].strip().replace('\n', '\n  '))
        
        # SUMMARY
        print("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print("âœ… CYCLE COMPLETE")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        print(f"Agent: {self.agent_id}")
        print(f"Capabilities: {sum(self.capabilities.values())}/{len(self.capabilities)}")
        print(f"Skills: {len(self.skills)} Claude skills")
        print(f"Tools: {len(self.github_tools)} GitHub + {len(self.kali)} Kali")
        print(f"Privileges: ROOT (UID {os.getuid()})")
        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n")

if __name__ == "__main__":
    agent = AgentZeroFull()
    agent.autonomous_cycle()
